<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Puddy General</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div id="game-container">
        <div id="main-area">
            <div id="header">
                <div id="game-title">Puddy General</div>
                <div id="level-display">Level 1: The First Battle</div>
            </div>
            <div id="map-area">
                <canvas id="game-canvas"></canvas>
                <div id="info-panel">
                    <span id="hex-info">Hover over a hex</span>
                </div>
            </div>
        </div>
        <div id="sidebar">
            <div id="sidebar-buttons">
                <button id="new-game-btn">New Game</button>
                <button id="rules-btn">Rules</button>
                <button id="test-level2-btn" style="background:linear-gradient(180deg,#7a5a2a 0%,#4a3a1a 100%);border-color:#aa8a4a;">Level 2</button>
            </div>
            <div id="sidebar-info">
                <div class="info-row">
                    <span class="info-label">Days:</span>
                    <span id="turn-display">1</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Castles:</span>
                    <span id="castle-display">0/3</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Prestige:</span>
                    <span id="prestige-display">150</span>
                </div>
            </div>
            <div id="sidebar-actions">
                <button id="inspect-btn" title="Inspect Unit">üîç Inspect</button>
                <button id="end-turn-btn">End Day</button>
            </div>
            <div id="sidebar-help">
                <div class="help-title">Keyboard:</div>
                <div class="help-item">G - Grid</div>
                <div class="help-item">C - Coords</div>
                <div class="help-item">I - Inspect</div>
                <div class="help-item">E - End Day</div>
                <div class="help-item">ESC - Deselect</div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="modal hidden">
        <div class="modal-content confirm-modal">
            <div class="modal-header" id="confirm-title">Confirm</div>
            <div class="modal-body">
                <p id="confirm-message">Are you sure?</p>
            </div>
            <div class="confirm-buttons">
                <button id="confirm-yes-btn" class="modal-btn confirm-yes">Yes</button>
                <button id="confirm-no-btn" class="modal-btn confirm-no">No</button>
            </div>
        </div>
    </div>

    <!-- Victory Modal -->
    <div id="victory-modal" class="modal hidden victory-modal">
        <div class="modal-content">
            <div class="modal-header">GLORIOUS VICTORY!</div>
            <div class="modal-body">
                <p>The enemy strongholds have fallen!</p>
                <p>Your banner flies over the castle.</p>
                <p id="victory-bonus-text" class="victory-bonus">Turns remaining: 0 (+0 prestige bonus!)</p>
                <p class="modal-footer-text">The realm is yours, my liege!</p>
            </div>
            <button id="victory-ok-btn" class="modal-btn">Long Live the King!</button>
        </div>
    </div>

    <!-- Defeat Modal -->
    <div id="defeat-modal" class="modal hidden defeat-modal">
        <div class="modal-content">
            <div class="modal-header">DEFEAT!</div>
            <div class="modal-body">
                <p>Time has run out!</p>
                <p>The enemy castles remain unconquered.</p>
                <p class="modal-footer-text">Perhaps another strategy is needed...</p>
            </div>
            <button id="defeat-ok-btn" class="modal-btn defeat-btn">Try Again</button>
        </div>
    </div>

    <!-- Rules Modal -->
    <div id="rules-modal" class="modal hidden">
        <div class="modal-content rules-modal">
            <div class="modal-header">Rules</div>
            <div class="modal-body rules-body">
                <p>This is Puddy, a land of many baronies where the barons happily exploit their peasants. Your baron, Puddy von Puddy, has made you his general. Puddy von Puddy has great plans of conquering all the neighbor baronies, one by one.</p>
                <p>For each barony you will have a set number of days to conquer all the castles. Should you fail to do so, the game is over. If you succeed, you will proceed to the next barony until you have won the entire kingdom and all the horses in it. If you finish conquering a barony early, you will be rewarded for it.</p>
                <p class="rules-section-title">Some important details:</p>
                <ul class="rules-list">
                    <li>A unit can regain its full strength if it is outside of an enemy zone of control and you are willing to spend the gold to do so (by inspecting the unit). This will take one day.</li>
                    <li>A ranged unit will defend nearby units if they are attacked.</li>
                </ul>
                <p class="rules-footer">Good luck!</p>
            </div>
            <button id="rules-ok-btn" class="modal-btn">Close</button>
        </div>
    </div>

    <!-- Unit Inspect Modal -->
    <div id="inspect-modal" class="modal hidden">
        <div class="modal-content inspect-modal">
            <div class="modal-header" id="inspect-unit-name">Unit Details</div>
            <div class="modal-body">
                <div class="inspect-section">
                    <div class="inspect-section-title">Status</div>
                    <div class="inspect-row">
                        <span class="inspect-label">Strength:</span>
                        <span id="inspect-strength">10/10</span>
                    </div>
                    <div class="inspect-row">
                        <span class="inspect-label">Movement:</span>
                        <span id="inspect-movement">3/3</span>
                    </div>
                    <div class="inspect-row">
                        <span class="inspect-label">Ammo:</span>
                        <span id="inspect-ammo">Unlimited</span>
                    </div>
                    <div class="inspect-row">
                        <span class="inspect-label">Experience:</span>
                        <span id="inspect-experience">0.0</span>
                    </div>
                    <div class="inspect-row">
                        <span class="inspect-label">Entrenchment:</span>
                        <span id="inspect-entrenchment">0</span>
                    </div>
                </div>
                <div class="inspect-section">
                    <div class="inspect-section-title">Combat Stats</div>
                    <div class="inspect-row">
                        <span class="inspect-label">Soft Attack:</span>
                        <span id="inspect-soft-attack">6</span>
                    </div>
                    <div class="inspect-row">
                        <span class="inspect-label">Hard Attack:</span>
                        <span id="inspect-hard-attack">2</span>
                    </div>
                    <div class="inspect-row">
                        <span class="inspect-label">Ground Defense:</span>
                        <span id="inspect-ground-defense">6</span>
                    </div>
                    <div class="inspect-row">
                        <span class="inspect-label">Close Defense:</span>
                        <span id="inspect-close-defense">8</span>
                    </div>
                    <div class="inspect-row">
                        <span class="inspect-label">Initiative:</span>
                        <span id="inspect-initiative">1</span>
                    </div>
                </div>
                <div class="inspect-section">
                    <div class="inspect-section-title">Other</div>
                    <div class="inspect-row">
                        <span class="inspect-label">Spotting:</span>
                        <span id="inspect-spotting">2</span>
                    </div>
                    <div class="inspect-row">
                        <span class="inspect-label">Range:</span>
                        <span id="inspect-range">Melee</span>
                    </div>
                    <div class="inspect-row">
                        <span class="inspect-label">Target Type:</span>
                        <span id="inspect-target-type">Soft</span>
                    </div>
                </div>
                <div class="inspect-description" id="inspect-description">
                    Basic foot soldiers armed with spears and swords.
                </div>
                <!-- Rebuild Section (shown only for player's wounded units) -->
                <div id="inspect-rebuild-section" class="inspect-section hidden">
                    <div class="inspect-section-title">Rebuild Unit</div>
                    <div class="inspect-row">
                        <span class="inspect-label">Missing Strength:</span>
                        <span id="inspect-missing-strength">0</span>
                    </div>
                    <div class="rebuild-buttons">
                        <button id="rebuild-with-exp-btn" class="rebuild-btn">
                            Rebuild (Keep Exp)<br>
                            <span class="rebuild-cost" id="rebuild-cost-exp">Cost: 0</span>
                        </button>
                        <button id="rebuild-cheap-btn" class="rebuild-btn">
                            Rebuild (Cheap)<br>
                            <span class="rebuild-cost" id="rebuild-cost-cheap">Cost: 0</span><br>
                            <span class="rebuild-exp-loss" id="rebuild-exp-loss">Exp loss: 0</span>
                        </button>
                    </div>
                    <div id="rebuild-status" class="rebuild-status"></div>
                </div>
            </div>
            <button id="inspect-ok-btn" class="modal-btn">Close</button>
        </div>
    </div>

    <!-- Battle Modal -->
    <div id="battle-modal" class="modal hidden">
        <div class="modal-content battle-modal">
            <div class="modal-header">BATTLE RESULTS</div>
            <div class="modal-body">
                <div class="battle-versus">
                    <div class="battle-unit-panel attacker">
                        <div class="battle-unit-name" id="battle-attacker-name">Attacker</div>
                        <div class="battle-unit-stats">
                            <span id="battle-attacker-before">10</span>
                            <span class="battle-arrow">&#8594;</span>
                            <span id="battle-attacker-after">7</span>
                        </div>
                        <div class="battle-damage" id="battle-attacker-damage">-3</div>
                    </div>
                    <span class="vs-text">VS</span>
                    <div class="battle-unit-panel defender">
                        <div class="battle-unit-name" id="battle-defender-name">Defender</div>
                        <div class="battle-unit-stats">
                            <span id="battle-defender-before">10</span>
                            <span class="battle-arrow">&#8594;</span>
                            <span id="battle-defender-after">6</span>
                        </div>
                        <div class="battle-damage" id="battle-defender-damage">-4</div>
                    </div>
                </div>
                <p class="battle-status" id="battle-status">Both units survive.</p>
                <!-- Debug/Dev Info -->
                <div class="battle-details">
                    <div class="battle-details-header">Combat Details</div>
                    <div class="battle-details-row">
                        <span class="detail-label">Power:</span>
                        <span id="battle-power-info">16 vs 20 (ratio: 0.80)</span>
                    </div>
                    <div class="battle-details-row">
                        <span class="detail-label">Terrain:</span>
                        <span id="battle-terrain-info">Open (Ground Def)</span>
                    </div>
                    <div class="battle-details-row">
                        <span class="detail-label">Entrenchment:</span>
                        <span id="battle-entrench-info">0 vs 3 ‚Üí 2</span>
                    </div>
                    <div class="battle-details-row">
                        <span class="detail-label">Experience:</span>
                        <span id="battle-exp-info">0 vs 0</span>
                    </div>
                    <div class="battle-details-row">
                        <span class="detail-label">Initiative:</span>
                        <span id="battle-init-info">+1 (attacker only)</span>
                    </div>
                    <div class="battle-details-row">
                        <span class="detail-label">Fatigue:</span>
                        <span id="battle-fatigue-info">None</span>
                    </div>
                    <div class="battle-details-row">
                        <span class="detail-label">Surprise:</span>
                        <span id="battle-surprise-info">No</span>
                    </div>
                    <div class="battle-details-row">
                        <span class="detail-label">River:</span>
                        <span id="battle-river-info">No</span>
                    </div>
                    <div class="battle-details-row">
                        <span class="detail-label">Raw Damage:</span>
                        <span id="battle-raw-damage">Atk: 4.2, Def: 2.8</span>
                    </div>
                </div>
            </div>
            <button id="battle-ok-btn" class="modal-btn">Continue</button>
        </div>
    </div>

    <!-- Level Intro Modal -->
    <div id="level-intro-modal" class="modal hidden">
        <div class="modal-content level-intro-modal">
            <div class="modal-header" id="level-intro-title">Level 1: Baron von Dunkhauzen</div>
            <div class="modal-body level-intro-body">
                <p id="level-intro-text"></p>
            </div>
            <button id="level-intro-ok-btn" class="modal-btn">To Battle!</button>
        </div>
    </div>

    <!-- Marketplace Modal -->
    <div id="marketplace-modal" class="modal hidden">
        <div class="modal-content marketplace-modal">
            <div class="modal-header">Marketplace</div>
            <div class="modal-body marketplace-body">
                <div class="marketplace-info">
                    <div class="marketplace-stat">
                        <span class="marketplace-label">Prestige:</span>
                        <span id="marketplace-prestige-value" class="marketplace-value prestige">500</span>
                    </div>
                    <div class="marketplace-stat">
                        <span class="marketplace-label">Army:</span>
                        <span id="marketplace-unit-count" class="marketplace-value">4 / 6</span>
                    </div>
                </div>
                <div class="marketplace-items">
                    <div class="marketplace-item" id="marketplace-infantry">
                        <div class="item-header">
                            <span class="item-name">Men-at-Arms</span>
                            <span class="item-cost">Cost: <span class="cost-value">60</span></span>
                        </div>
                        <div class="item-description">Basic foot soldiers armed with spears and swords. Reliable and cost-effective.</div>
                        <div class="item-actions">
                            <button class="marketplace-inspect-btn" id="inspect-infantry-btn" title="View Details">üîç</button>
                            <button class="marketplace-buy-btn" id="buy-infantry-btn">Purchase</button>
                        </div>
                    </div>
                    <div class="marketplace-item" id="marketplace-trebuchet">
                        <div class="item-header">
                            <span class="item-name">Trebuchet</span>
                            <span class="item-cost">Cost: <span class="cost-value">84</span></span>
                        </div>
                        <div class="item-description">Siege engine that hurls heavy projectiles. Devastating at range but vulnerable in melee.</div>
                        <div class="item-actions">
                            <button class="marketplace-inspect-btn" id="inspect-trebuchet-btn" title="View Details">üîç</button>
                            <button class="marketplace-buy-btn" id="buy-trebuchet-btn">Purchase</button>
                        </div>
                    </div>
                    <div class="marketplace-item" id="marketplace-cavalry">
                        <div class="item-header">
                            <span class="item-name">Knights</span>
                            <span class="item-cost">Cost: <span class="cost-value">120</span></span>
                        </div>
                        <div class="item-description">Heavily armored mounted knights. Devastating charge on open ground but vulnerable in close terrain.</div>
                        <div class="item-actions">
                            <button class="marketplace-inspect-btn" id="inspect-cavalry-btn" title="View Details">üîç</button>
                            <button class="marketplace-buy-btn" id="buy-cavalry-btn">Purchase</button>
                        </div>
                    </div>
                </div>
            </div>
            <button id="marketplace-done-btn" class="modal-btn">Continue to Battle</button>
        </div>
    </div>

    <!-- Load scripts in order -->
    <script src="js/config.js"></script>
    <script src="js/core/hex.js"></script>
    <script src="js/terrain/terrainTypes.js"></script>
    <script src="js/units/unitTypes.js"></script>
    <script src="js/units/unit.js"></script>
    <script src="js/units/rebuild.js"></script>
    <script src="js/core/map.js"></script>
    <script src="js/levels/level1.js"></script>
    <script src="js/levels/level2.js"></script>
    <script src="js/levels/levelManager.js"></script>
    <script src="js/core/gameState.js"></script>
    <script src="js/rendering/hexRenderer.js"></script>
    <script src="js/rendering/edgeRenderer.js"></script>
    <script src="js/rendering/fogOfWar.js"></script>
    <script src="js/rendering/unitRenderer.js"></script>
    <script src="js/rendering/renderer.js"></script>
    <script src="js/utils/storage.js"></script>
    <script src="js/combat/battleResolver.js"></script>
    <script src="js/combat/enemyAI.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
